
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Krux is open-source firmware that enables anyone to build their own Bitcoin signing device via off-the-shelf parts.">
      
      
      
        <link rel="canonical" href="https://selfcustody.github.io/krux/getting-started/features/encryption/kef-specifications/">
      
      
        <link rel="prev" href="../encryption/">
      
      
        <link rel="next" href="../../printing/printing/">
      
      
      <link rel="icon" href="../../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>KEF Specifications - Krux - Open-source signing device firmware for Bitcoin</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/custom.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kef-encryption-format-technical-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Krux - Open-source signing device firmware for Bitcoin" class="md-header__button md-logo" aria-label="Krux - Open-source signing device firmware for Bitcoin" data-md-component="logo">
      
  <img src="../../../../img/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Krux - Open-source signing device firmware for Bitcoin
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              KEF Specifications
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/selfcustody/krux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../encryption/" class="md-tabs__link">
          
  
  
    
  
  Exploring Features

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../video-tutorials/" class="md-tabs__link">
        
  
  
    
  
  Video Tutorials

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../parts/" class="md-tabs__link">
        
  
  
    
  
  Devices and Parts List

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../faq/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../troubleshooting/" class="md-tabs__link">
        
  
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../support/" class="md-tabs__link">
        
  
  
    
  
  Support the Project

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Krux - Open-source signing device firmware for Bitcoin" class="md-nav__button md-logo" aria-label="Krux - Open-source signing device firmware for Bitcoin" data-md-component="logo">
      
  <img src="../../../../img/favicon.png" alt="logo">

    </a>
    Krux - Open-source signing device firmware for Bitcoin
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/selfcustody/krux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../installing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Installing
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Installing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../installing/from-gui/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    From GUI application
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            From GUI application
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/macos-intel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MacOS Intel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/macos-arm64/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MacOS ARM64
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/debian-like/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debian-like
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/fedora-like/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fedora-like
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/other-linux-distro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other linux distro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-gui/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-pre-built-release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    From pre-built official release
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-test-release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    From pre-built test release
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installing/from-source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    From source
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../usage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Basic Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/generating-a-mnemonic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating a Mnemonic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/loading-a-mnemonic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Loading a Mnemonic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/navigating-the-main-menu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Navigating the Main Menu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/setting-a-coordinator-and-signing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting a Coordinator and Signing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Exploring Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Exploring Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1_1" id="__nav_3_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Encryption
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            Encryption
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../encryption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Encryption Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    KEF Specifications
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    KEF Specifications
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generalizations-regarding-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Generalizations Regarding Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-structure-of-a-kef-envelope" class="md-nav__link">
    <span class="md-ellipsis">
      Common Structure of a KEF Envelope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Structure of a KEF Envelope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#versions-details" class="md-nav__link">
    <span class="md-ellipsis">
      Versions - Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Versions - Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v0-aes-ecb-v1" class="md-nav__link">
    <span class="md-ellipsis">
      v0: "AES-ECB v1"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v1-aes-cbc-v1" class="md-nav__link">
    <span class="md-ellipsis">
      v1: "AES-CBC v1"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v5-aes-ecb" class="md-nav__link">
    <span class="md-ellipsis">
      v5: "AES-ECB"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v6-aes-ecb-p" class="md-nav__link">
    <span class="md-ellipsis">
      v6: "AES-ECB +p"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v7-aes-ecb-c" class="md-nav__link">
    <span class="md-ellipsis">
      v7: "AES-ECB +c"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v10-aes-cbc" class="md-nav__link">
    <span class="md-ellipsis">
      v10: "AES-CBC"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v11-aes-cbc-p" class="md-nav__link">
    <span class="md-ellipsis">
      v11: "AES-CBC +p"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v12-aes-cbc-c" class="md-nav__link">
    <span class="md-ellipsis">
      v12: "AES-CBC +c"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v15-aes-ctr" class="md-nav__link">
    <span class="md-ellipsis">
      v15: "AES-CTR"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v16-aes-ctr-c" class="md-nav__link">
    <span class="md-ellipsis">
      v16: "AES-CTR +c"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v20-aes-gcm" class="md-nav__link">
    <span class="md-ellipsis">
      v20: "AES-GCM"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v21-aes-gcm-c" class="md-nav__link">
    <span class="md-ellipsis">
      v21: "AES-GCM +c"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-table" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kef-implementation-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      KEF Implementation Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KEF Implementation Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Version Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing-a-version" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing a Version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-decryption-and-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption, Decryption, and Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#padding-and-unpadding" class="md-nav__link">
    <span class="md-ellipsis">
      Padding and Unpadding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-compression-deflate-inflate" class="md-nav__link">
    <span class="md-ellipsis">
      Data Compression: Deflate &amp; Inflate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-wrapping-and-unwrapping" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Wrapping and Unwrapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-further-encoding-kef-envelopes" class="md-nav__link">
    <span class="md-ellipsis">
      On Further Encoding KEF Envelopes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Printing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            Printing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../printing/printing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Printing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../printing/cnc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CNC Engraving
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sd-card-update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SD Card Updates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../QR-transcript-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transcribing QR Codes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tinyseed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tiny Seed and other metal plates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../entropy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Empirical Entropy Measurement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tamper-detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tamper Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mnemonic-xor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mnemonic XOR
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../navigation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Navigation overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../templates/templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../video-tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../parts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Devices and Parts List
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support the Project
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="kef-encryption-format-technical-specification">KEF Encryption Format - Technical Specification<a class="headerlink" href="#kef-encryption-format-technical-specification" title="Permanent link">&para;</a></h1>
<p>...<code>The K stands for "KEF"</code> -anon</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>In the autumn of 2023, during the lead-up to <strong>krux release 23.09.0</strong>, contributors proposed a method of encrypting bip39 mnemonics that could be stored in SPI-flash, on sdcard, and/or exported to QR. Regarding the encrypted-mnemonic QR format: the layout proposed was interesting as an extensible, lite-weight, self-describing envelope that has been appreciated by users ever since.</p>
<p>...<code>"Wen passphrases, output descriptors, PSBTs, and notes?"</code> -plebs</p>
<p>This specification, and its accompanying implementation and test-suite are the result of months of exploration into improvements meant to better define, test, and extend the original encryption format that we'll refer to as KEF. It proposes ten new versions, extending its usefulness to more than mnemonics, targeting variable-length strings up to moderately sized PSBTs, flexibility to choose among four AES modes of operation, with-or-without compression, and versions optimized to result in a smaller envelope.</p>
<p>Above all, this specification aims to be supported by as many projects as would consider adopting it, so that users are not "locked" into a particular project when recovering their secrets. Corrections and refinement to, and scrutiny of this specification are appreciated. Proposals for more <code>versions</code> are welcome, provided they offer "value" to the user and fit within the scope of this system. Once released, because it cannot be known how many KEF envelopes may exist in-the-wild, changes to any particular version must remain backwards compatible for decryption. Adopting implementations are free to support any KEF versions they wish to support, for decryption-only or for both encryption and decryption - with the expectation that claims-of-support made are clear and precise about what is supported.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>This system encrypts arbitrary plaintext into a versioned, self-describing, <strong>KEF envelope</strong> which includes:</p>
<ul>
<li>custom identity/label <code>len_id</code> and <code>id</code></li>
<li>version <code>v</code></li>
<li>pbkdf2-hmac iterations <code>i</code></li>
<li>and cipher-payload <code>cpl</code></li>
</ul>
<p>where cipher-payload <code>cpl</code> consists of:</p>
<ul>
<li>Initialization-Vector/Nonce (if applicable) <code>IV</code></li>
<li>ciphertext</li>
<li>and authentication/validation data <code>auth</code></li>
</ul>
<p>KEF versions offer combinations of different <strong>modes-of-operation</strong>, <strong>authentication strategies</strong>, <strong>padding strategies</strong>, and <strong>compression</strong>, all selected via a numeric version code (0 - 21).</p>
<ul>
<li>Available version codes are: 0, 1, 5, 6, 7, 10, 11, 12, 15, 16, 20, 21. Not all integers in the range are assigned, and implementations may disable versions or modes.</li>
</ul>
<p>Currently, all versions use AES and derive the 256-bit encryption key <code>k</code> as:
<div class="highlight"><pre><span></span><code>k = pbkdf2_hmac_sha256(K, id, i)
</code></pre></div></p>
<p>where:</p>
<ul>
<li><code>K</code> = user-provided password/key material (bytes; if str: non-normalized encode as utf-8)</li>
<li><code>id</code> = salt (variable-length, prepended to envelope; bytes: if str: non-normalized encode as utf-8)</li>
<li><code>i</code> = iteration count (3 bytes, big-endian)</li>
</ul>
<p>The stored iteration field <code>i</code> MUST be â‰¥ 1. The effective PBKDF2 iteration count is <code>i</code> if <code>i &gt; 10,000</code>, otherwise <code>i * 10,000</code>.</p>
<p>Compression (when enabled) uses zlib.compress(wbits=-10) or raw deflate(micropython).</p>
<p>Authentication has three forms:</p>
<ul>
<li>When the mode has built-in authentication, like GCM: <code>auth</code> is a truncated auth tag</li>
<li>When the mode does not have built-in authentication, <code>auth</code> is a truncated sha256 digest whose pre-image is of two forms:<ul>
<li>if <code>auth</code> will be encrypted with plaintext, hidden, it is <code>sha256(plaintext)</code></li>
<li>if <code>auth</code> will be appended to ciphertext, exposed, it is <code>sha256(version || IV || plaintext || derived-k)</code></li>
</ul>
</li>
</ul>
<h2 id="generalizations-regarding-implementation">Generalizations Regarding Implementation<a class="headerlink" href="#generalizations-regarding-implementation" title="Permanent link">&para;</a></h2>
<p>It is expected that any implementation can decrypt a KEF envelope that was created by itself on the same device. Implementations are asked to make their "best-effort" to be capable of decrypting KEF envelopes for versions they support which were created by other implementations or on other devices - but this will not always be possible. Decrypting large KEF envelopes on severely constrained devices, or ones created with flawed implementations is unrealistic. Therefore, in such cases it is the responsibility of the user to find an implementation and device capable of decrypting their KEF envelope, or to have a non-KEF form of recovery.</p>
<ul>
<li>
<p>Be strict while encrypting. Be tolerant - and non-specific about errors, when decrypting.</p>
</li>
<li>
<p>At its base, <strong>a KEF envelope is a format of bytes - so are all of its inputs</strong>. Remember this when converting strings gathered for the <code>key</code> and <code>id</code>. Consider being strict about offering a reasonably minimal set of characters, common and available on other devices and/or international keyboards when encrypting - then encode unicode codepoints (if not ascii) directly to their utf-8 representations without normalization. For decryption, more characters could be offered when gathering the <code>key</code>, and multiple normalization strategies may be tried, so that secrets may be recovered. Consider some capability of displaying both <code>key</code> and <code>id</code> as bytes, and gathering the <code>key</code> as bytes either directly or via hex/base64 conversion if necessary, to enable recovery. Do NOT assume that a user originally used a particular implementation to encrypt a KEF envelope.</p>
</li>
<li>
<p><strong>On the importance of a STRONG user-supplied <code>key</code></strong> This cannot be stressed enough to each user of KEF. While KEF allows for key-stretching via <code>id</code> and <code>iterations</code>, and offers modes that require a random <code>IV</code> / Nonce, <strong>KEF offers no expectation of security for a weak user-supplied <code>key</code></strong>. Consider making this point clear to users before encrypting and/or offer an indication of <code>key</code> strength once gathered. If a KEF envelope has been created with a "weak" <code>key</code> and stored accessible to others, user should assume that their secret has been leaked. Consider encouraging users to make sane choices about the characters they use in their <code>key</code>, aware that non-ascii characters offered by one implementation may not be easy to enter on another, or that a recognizable glyph may not exist on other devices for them to verify their <code>key</code> when decrypting.</p>
</li>
<li>
<p><strong>On security</strong> Not all KEF <code>versions</code> offer the same security guarantees, so implementors MUST take care to protect against "unsafe" usage. As already mentioned: be strict and fail to encrypt when "unsafe"; be tolerant and vague while decrypting. Support for decrypt-only on a particular version is perfectly valid should an implementation choose to "nudge" users towards a more-secure version where it supports full encrypt/decrypt functionality.</p>
<ul>
<li>
<p><strong>On mode ECB</strong>: Repeated blocks would leak patterns within ciphertext. Therefore, be strict - refuse to encrypt using mode ECB whenever duplicate blocks are detected. Consider a compressed version which may resolve this.</p>
</li>
<li>
<p><strong>On block modes with NUL padding</strong> Problems to unpad can arise decrypting where valid NUL bytes are confused with removable padding.</p>
<ul>
<li>If <code>auth</code> is appended to plaintext before padding AND the <code>auth</code> bytes end in 0x00: be strict - refuse to encrypt. Consider a version with safe padding.</li>
<li>If <code>auth</code> is appended to ciphertext after padding/encryption AND the <code>plaintext</code> bytes end in 0x00: be strict - refuse to encrypt. Consider a version with safe padding.</li>
<li>Do not assume that other implementations adhere to the above. Be tolerant and make reasonable efforts to successfully recover secrets when decrypting. Offering a warning to users AFTER successful decryption in this case may be appropriate.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>On modes that require IV or Nonce</strong> Take precautions to ensure that this value is random and not reused. ie: Natural entropy captured from camera sensor (user validated and/or analyzed to ensure sensor is working / high entropy).</p>
</li>
<li>
<p><strong>On common <code>bytes</code> encodings</strong> Outside the strict scope that <strong>KEF envelopes are a format of bytes</strong> but related to this topic: implementations may be presented with encoded strings that are likely to represent bytes. For instance: base64, base43 (from electrum), base32, or hex might be representations of a KEF envelope that was previously encoded for transport. As you continue reading, it will become clear that with any bytestring, one may recognize a KEF envelope by:</p>
<ol>
<li>reading the first byte as an integer <code>len_id</code>,</li>
<li>jumping that many bytes, over the <code>id</code>, to read the next byte as an integer <code>version</code>,</li>
<li>if that version represents a known and supported KEF version, then the rest of the envelope may be parsed via that version's KEF rules.</li>
<li>if parsing succeeds without errors, it is likely to be a KEF envelope and a decryption user-interface should be offered to the user.
While the user likely knows, the process instance of a KEF implementation will learn definitively, only AFTER a successful decryption, that a bytestring was indeed a KEF envelope. If at any point along this process, an implementation finds that <code>version</code> is unknown/disabled, or if parsing fails, the expected action is NOT TO RAISE SPECIFIC ERRORS regarding this inspection. Rather, the appropriate action is to assume it was not a KEF envelope and to treat the data under another context: ie: "Unknown". Similarly, as mentioned above, being vague about errors during decryption implies that "Failed!" may be a sufficient response for any error, instead of leaking to a potential attacker specific details about the failure.</li>
</ol>
</li>
<li>
<p><strong>On Iterations</strong> Consider that users may want to decrypt KEF envelopes on various resource-constrained devices. There is a minimum 10,000 iterations imposed in any KEF envelope (a value of 1 would be 10,000 pbkdf2_hmac iterations), and the maximum could be as high as 100,000,000 (a value of 10,000), but depending on the device used, 500,000 might be too high. Also, since the user-supplied <code>key</code> is stretched by this value, consider offering a range to users - then adding a small <code>delta</code> as extra bits of entropy to derive different AES-256 keys that would otherwise be the same in the event the user re-uses the same <code>key</code>, <code>id</code> and <code>iterations</code> when creating many KEF envelopes.</p>
</li>
<li>
<p><strong>On truncated Authentication</strong> At first glance it may be concerning that <code>auth</code> bytes for many versions have been truncated and are trivially "weak". Note that KEF's use-case for authentication is to validate that the user has correctly entered their decryption <code>key</code>. In the worse case, "false-authenticated" success will occur at a rate of 1:16M (or 1:4B for others) if using an incorrect decryption <code>key</code>; similar if an attacker has modified the KEF envelope. In these "false-authenticated" success cases, data will result from decryption, but that data will NOT be the original secret or plaintext; it will be of no value.</p>
</li>
<li>
<p><strong>On compressed versions</strong> KEF is strict about compressing via "raw headerless deflate()" with a "wbits" window
of <strong>10 bits (1024B)</strong> so that other implementations on restricted hardware are capable to decompress and recover
any KEF envelope.  However, implementations may choose to use a higher wbits window for decompression.</p>
</li>
</ul>
<h2 id="common-structure-of-a-kef-envelope">Common Structure of a KEF Envelope<a class="headerlink" href="#common-structure-of-a-kef-envelope" title="Permanent link">&para;</a></h2>
<p>All KEF versions' encrypted outputs follow this layout:
<div class="highlight"><pre><span></span><code>len_id + id + v + i + cpl
</code></pre></div></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Size</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>len_id</code></td>
<td>1 byte</td>
<td>Length of <code>id</code> (0 - 252)</td>
</tr>
<tr>
<td><code>id</code></td>
<td><code>len_id</code> bytes</td>
<td>Salt for PBKDF2</td>
</tr>
<tr>
<td><code>v</code></td>
<td>1 byte</td>
<td>Version number</td>
</tr>
<tr>
<td><code>i</code></td>
<td>3 bytes</td>
<td>Iteration count (big-endian; if &lt;= 10,000: *= 10,000)</td>
</tr>
<tr>
<td><code>cpl</code></td>
<td>Variable</td>
<td>Cipher PayLoad (IV + ciphertext + auth)</td>
</tr>
</tbody>
</table>
<p>The Cipher PayLoad <code>cpl</code> structure varies by version. </p>
<hr />
<h3 id="versions-details">Versions - Details<a class="headerlink" href="#versions-details" title="Permanent link">&para;</a></h3>
<p>Details for currently-available versions of KEF follow. The top half of each section is pre-formatted <code>self-doc</code> text, built from the reference implementation's test-suite (using KEF <code>VERSION</code> constants as KEF's rule-set). The bottom half of each section with rich-formatted text was initially LLM-generated, prompted with the <code>self-doc</code> text, then curated and edited by hand.</p>
<h4 id="v0-aes-ecb-v1">v0: "AES-ECB v1"<a class="headerlink" href="#v0-aes-ecb-v1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-ECB v1] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =0
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: e.encrypt(P + auth + pad)
e: AES(k, ECB)
auth: sha256(P)[:16]
pad: NUL
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: ECB</li>
<li><strong>IV</strong>: None</li>
<li><strong>Padding</strong>: NUL bytes to block boundary</li>
<li><strong>Authentication</strong>: First 16 bytes of <code>SHA256(plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[ciphertext]</code> (auth embedded before padding/encryption)</li>
<li><strong>Use Case</strong>: LEGACY: consider using version 5; encryption of 16 or 32 BIP39 entropy bytes</li>
<li><strong>Security Note</strong>: When encrypting: fail "unsafe" if duplicate plaintext blocks, fail "unsafe" if auth ends 0x00</li>
</ul>
<hr />
<h4 id="v1-aes-cbc-v1">v1: "AES-CBC v1"<a class="headerlink" href="#v1-aes-cbc-v1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-CBC v1] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =1
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(P + auth + pad)
iv: 16b
e: AES(k, CBC, iv)
auth: sha256(P)[:16]
pad: NUL
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: CBC</li>
<li><strong>IV</strong>: 16 bytes</li>
<li><strong>Padding</strong>: NUL bytes to block boundary</li>
<li><strong>Authentication</strong>: First 16 bytes of <code>SHA256(plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[iv (16)] + [ciphertext]</code> (auth embedded before padding/encryption)</li>
<li><strong>Use Case</strong>: LEGACY: consider using version 10; encryption of 16 or 32 BIP39 entropy bytes</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV, fail "unsafe" if auth ends 0x00</li>
</ul>
<hr />
<h4 id="v5-aes-ecb">v5: "AES-ECB"<a class="headerlink" href="#v5-aes-ecb" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-ECB] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =5
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: e.encrypt(P + pad) + auth
e: AES(k, ECB)
pad: NUL
auth: sha256(v + P + k)[:3]
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: ECB</li>
<li><strong>IV</strong>: None</li>
<li><strong>Padding</strong>: NUL bytes to block boundary</li>
<li><strong>Authentication</strong>: First 3 bytes of <code>SHA256(version_byte + plaintext + derived_key)</code>, exposed</li>
<li><strong>cpl layout</strong>: <code>[ciphertext] + [auth (3)]</code></li>
<li><strong>Use Case</strong>: smallest KEF envelope for high-entropy secrets (BIP39 entropy, passphrase, cryptographic keys)</li>
<li><strong>Security Note</strong>: When encrypting: fail "unsafe" if duplicate plaintext blocks, fail "unsafe" if plaintext ends 0x00</li>
</ul>
<hr />
<h4 id="v6-aes-ecb-p">v6: "AES-ECB +p"<a class="headerlink" href="#v6-aes-ecb-p" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-ECB +p] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =6
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: e.encrypt(P + auth + pad)
e: AES(k, ECB)
auth: sha256(P)[:4]
pad: PKCS7
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: ECB</li>
<li><strong>IV</strong>: None</li>
<li><strong>Padding</strong>: PKCS7 to block boundary</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[ciphertext]</code> (auth embedded before padding/encryption)</li>
<li><strong>Use Case</strong>: Mid-sized variable length plaintext</li>
<li><strong>Security Note</strong>: When encrypting: fail "unsafe" if duplicate plaintext blocks</li>
</ul>
<hr />
<h4 id="v7-aes-ecb-c">v7: "AES-ECB +c"<a class="headerlink" href="#v7-aes-ecb-c" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-ECB +c] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =7
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: e.encrypt(zlib(P, wbits=-10) + auth + pad)
e: AES(k, ECB)
auth: sha256(zlib(P, wbits=-10))[:4]
pad: PKCS7
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: ECB</li>
<li><strong>IV</strong>: None</li>
<li><strong>Compression</strong>: <code>zlib.compress(P, wbits=-10)</code>, - raw deflate</li>
<li><strong>Padding</strong>: PKCS7 to block boundary</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[ciphertext]</code> (auth embedded after compression, before padding/encryption)</li>
<li><strong>Use Case</strong>: Mid-sized variable length plaintext</li>
<li><strong>Security Note</strong>: like others, when encrypting: fail "unsafe" if duplicate blocks - unlikely with compression </li>
</ul>
<hr />
<h4 id="v10-aes-cbc">v10: "AES-CBC"<a class="headerlink" href="#v10-aes-cbc" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-CBC] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =10
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(P + pad) + auth
iv: 16b
e: AES(k, CBC, iv)
pad: NUL
auth: sha256(v + iv + P + k)[:4]
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: CBC</li>
<li><strong>IV</strong>: 16 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Padding</strong>: NUL bytes to block boundary</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(v + iv + P + k)</code>, exposed</li>
<li><strong>cpl layout</strong>: <code>[iv (16)] + [ciphertext] + [auth (4)]</code></li>
<li><strong>Use Case</strong>: Mnemonics, passphrases, short secrets</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV, fail "unsafe" if plaintext ends 0x00</li>
</ul>
<hr />
<h4 id="v11-aes-cbc-p">v11: "AES-CBC +p"<a class="headerlink" href="#v11-aes-cbc-p" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-CBC +p] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =11
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(P + auth + pad)
iv: 16b
e: AES(k, CBC, iv)
auth: sha256(P)[:4]
pad: PKCS7
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: CBC</li>
<li><strong>IV</strong>: 16 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Padding</strong>: PKCS7 to block boundary</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[iv] + [ciphertext]</code> (auth embedded before padding/encryption)</li>
<li><strong>Use Case</strong>: General mid-sized plaintext</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV</li>
</ul>
<hr />
<h4 id="v12-aes-cbc-c">v12: "AES-CBC +c"<a class="headerlink" href="#v12-aes-cbc-c" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-CBC +c] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =12
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(zlib(P, wbits=-10) + auth + pad)
iv: 16b
e: AES(k, CBC, iv)
auth: sha256(zlib(P, wbits=-10))[:4]
pad: PKCS7
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: CBC</li>
<li><strong>IV</strong>: 16 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Compression</strong>: <code>zlib.compress(P, wbits=-10)</code>, - raw deflate</li>
<li><strong>Padding</strong>: PKCS7 to block boundary</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(compressed plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[iv (16)] + [ciphertext]</code> (auth embedded after compression, before padding/encryption)</li>
<li><strong>Use Case</strong>: Larger plaintext</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV</li>
</ul>
<hr />
<h4 id="v15-aes-ctr">v15: "AES-CTR"<a class="headerlink" href="#v15-aes-ctr" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-CTR] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =15
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(P + auth)
iv: 12b
e: AES(k, CTR, iv)
auth: sha256(P)[:4]
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: CTR</li>
<li><strong>IV</strong>: 12 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Padding</strong>: None</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[iv (12)] + [ciphertext]</code> (auth embedded before padding/encryption)</li>
<li><strong>Use Case</strong>: Small to mid-sized plaintext</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV</li>
</ul>
<hr />
<h4 id="v16-aes-ctr-c">v16: "AES-CTR +c"<a class="headerlink" href="#v16-aes-ctr-c" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-CTR +c] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =16
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(zlib(P, wbits=-10) + auth)
iv: 12b
e: AES(k, CTR, iv)
auth: sha256(zlib(P, wbits=-10))[:4]
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: CTR</li>
<li><strong>IV</strong>: 12 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Compression</strong>: <code>zlib.compress(P, wbits=-10)</code>, - raw deflate</li>
<li><strong>Padding</strong>: None</li>
<li><strong>Authentication</strong>: First 4 bytes of <code>SHA256(compressed plaintext)</code>, hidden</li>
<li><strong>cpl layout</strong>: <code>[iv (12)] + [ciphertext]</code> (auth embedded after compression, before padding/encryption)</li>
<li><strong>Use Case</strong>: Larger plaintext</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV</li>
</ul>
<hr />
<h4 id="v20-aes-gcm">v20: "AES-GCM"<a class="headerlink" href="#v20-aes-gcm" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-GCM] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =20
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(P) + auth
iv: 12b
e: AES(k, GCM, iv)
auth: e.authtag[:4]
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: GCM</li>
<li><strong>IV/Nonce</strong>: 12 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Padding</strong>: None</li>
<li><strong>Authentication</strong>: First 4 bytes of GCM authtag, exposed</li>
<li><strong>cpl layout</strong>: <code>[iv (12)] + [ciphertext] + [auth (4)]</code></li>
<li><strong>Use Case</strong>: DEFAULT: Small to mid-sized plaintext</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV/Nonce</li>
</ul>
<hr />
<h4 id="v21-aes-gcm-c">v21: "AES-GCM +c"<a class="headerlink" href="#v21-aes-gcm-c" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>[AES-GCM +c] KEF bytes: len_id + id + v + i + cpl
len_id: 1b
id: &lt;len_id&gt;b
v: 1b; =21
i: 3b big; =(i &gt; 10K) ? i : i * 10K
cpl: iv + e.encrypt(zlib(P, wbits=-10)) + auth
iv: 12b
e: AES(k, GCM, iv)
auth: e.authtag[:4]
k: pbkdf2_hmac_sha256(K, id, i)
</code></pre></div>
<ul>
<li><strong>Mode</strong>: GCM</li>
<li><strong>IV/Nonce</strong>: 12 bytes, random, prepended in <code>cpl</code></li>
<li><strong>Compression</strong>: <code>zlib.compress(P, wbits=-10)</code>, - raw deflate</li>
<li><strong>Padding</strong>: None</li>
<li><strong>Authentication</strong>: First 4 bytes of GCM authtag, exposed</li>
<li><strong>cpl layout</strong>: <code>[iv (12)] + [ciphertext] + [auth (4)]</code></li>
<li><strong>Use Case</strong>: DEFAULT: Larger plaintext</li>
<li><strong>Security Note</strong>: When encrypting: do not re-use IV/Nonce</li>
</ul>
<hr />
<h4 id="summary-table">Summary Table<a class="headerlink" href="#summary-table" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Ver</th>
<th>Name</th>
<th>Mode</th>
<th>IV</th>
<th>Padding</th>
<th>Compress</th>
<th>Authentication Method</th>
<th>Auth</th>
<th>Intended Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>AES-ECB v1</td>
<td>ECB</td>
<td>â€“</td>
<td>NUL</td>
<td>No</td>
<td>SHA256(plaintext)[:16]</td>
<td>16 B</td>
<td>Legacy high-entropy</td>
</tr>
<tr>
<td>1</td>
<td>AES-CBC v1</td>
<td>CBC</td>
<td>16</td>
<td>NUL</td>
<td>No</td>
<td>SHA256(plaintext)[:16]</td>
<td>16 B</td>
<td>Legacy high-entropy</td>
</tr>
<tr>
<td>5</td>
<td>AES-ECB</td>
<td>ECB</td>
<td>â€“</td>
<td>NUL</td>
<td>No</td>
<td>SHA256(v+P+k)[:3]</td>
<td>3 B exposed</td>
<td>Small, high-entropy</td>
</tr>
<tr>
<td>6</td>
<td>AES-ECB +p</td>
<td>ECB</td>
<td>â€“</td>
<td>PKCS7</td>
<td>No</td>
<td>SHA256(plaintext)[:4]</td>
<td>4 B</td>
<td>General Mid-sized</td>
</tr>
<tr>
<td>7</td>
<td>AES-ECB +c</td>
<td>ECB</td>
<td>â€“</td>
<td>PKCS7</td>
<td>Yes</td>
<td>SHA256(compressed)[:4]</td>
<td>4 B</td>
<td>Large; duplicate blocks</td>
</tr>
<tr>
<td>10</td>
<td>AES-CBC</td>
<td>CBC</td>
<td>16</td>
<td>NUL</td>
<td>No</td>
<td>SHA256(v+iv+P+k)[:4]</td>
<td>4 B exposed</td>
<td>Small, high-entropy</td>
</tr>
<tr>
<td>11</td>
<td>AES-CBC +p</td>
<td>CBC</td>
<td>16</td>
<td>PKCS7</td>
<td>No</td>
<td>SHA256(plaintext)[:4]</td>
<td>4 B</td>
<td>General mid-sized</td>
</tr>
<tr>
<td>12</td>
<td>AES-CBC +c</td>
<td>CBC</td>
<td>16</td>
<td>PKCS7</td>
<td>Yes</td>
<td>SHA256(compressed)[:4]</td>
<td>4 B</td>
<td>General large</td>
</tr>
<tr>
<td>15</td>
<td>AES-CTR</td>
<td>CTR</td>
<td>12</td>
<td>â€“</td>
<td>No</td>
<td>SHA256(plaintext)[:4]</td>
<td>4 B</td>
<td>General mid-sized</td>
</tr>
<tr>
<td>16</td>
<td>AES-CTR +c</td>
<td>CTR</td>
<td>12</td>
<td>â€“</td>
<td>Yes</td>
<td>SHA256(compressed)[:4]</td>
<td>4 B</td>
<td>General large</td>
</tr>
<tr>
<td>20</td>
<td>AES-GCM</td>
<td>GCM</td>
<td>12</td>
<td>â€“</td>
<td>No</td>
<td>GCM authtag[:4]</td>
<td>4 B exposed</td>
<td>Best, General mid-sized</td>
</tr>
<tr>
<td>21</td>
<td>AES-GCM +c</td>
<td>GCM</td>
<td>12</td>
<td>â€“</td>
<td>Yes</td>
<td>GCM authtag[:4]</td>
<td>4 B exposed</td>
<td>Best, General large</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="kef-implementation-concepts">KEF Implementation Concepts<a class="headerlink" href="#kef-implementation-concepts" title="Permanent link">&para;</a></h2>
<p>Using examples from, and as an introduction to the reference <a href="https://github.com/selfcustody/krux/blob/develop/src/krux/kef.py">KEF implementation</a>, we'll quickly cover some basic concepts that may be helpful in getting started with your own KEF implementation.</p>
<h3 id="version-configuration">Version Configuration<a class="headerlink" href="#version-configuration" title="Permanent link">&para;</a></h3>
<p>From the version details and summary table: note that all KEF versions can be defined as having a set of parameters which define that version's KEF rules. For ease-of-maintenance - and also for extending later, it may be useful to store these in a central configuration. Within our sample reference, these are defined by constants <code>kef.VERSIONS</code>, <code>kef.MODE_NUMBERS</code> and <code>kef.MODE_IVS</code>.</p>
<h3 id="choosing-a-version">Choosing a Version<a class="headerlink" href="#choosing-a-version" title="Permanent link">&para;</a></h3>
<p>As soon as you have data to hide, KEF offers choices for which version to use. That choice may be made by the user, or by the implementation, based on what is being hidden, compatibility with others, and how it may be stored/transported. The sample reference uses a function named <code>kef.suggest_versions()</code> to make a choice based on user's preferred mode-of-operation, the plaintext being hidden, then optimizes for a smaller KEF envelope.</p>
<h3 id="encryption-decryption-and-authentication">Encryption, Decryption, and Authentication<a class="headerlink" href="#encryption-decryption-and-authentication" title="Permanent link">&para;</a></h3>
<p>Once you know what you need to hide and how you want to hide it, you'll need something to perform the encryption. You'll start by stretching the user-supplied <code>key</code>, salted with <code>id</code> for a number of <code>iterations</code> to <strong>derive</strong> the 256-bit AES key. Next you'll need to <strong>encrypt</strong> the plaintext (possibly with a random <code>IV</code> / Nonce) according to the chosen KEF version, so that the result is a cipher-payload <code>cpl</code>. To reverse this process, you'll need something to <strong>decrypt</strong> and <strong>authenticate</strong> the cipher-payload <code>cpl</code> - again according to the rules of the particular KEF version. The sample reference uses a class named <code>kef.Cipher</code> for stretching the <code>key</code>, encrypting plaintext to <code>cpl</code>, and decrypting / authenticating <code>cpl</code> back into plaintext.</p>
<h3 id="padding-and-unpadding">Padding and Unpadding<a class="headerlink" href="#padding-and-unpadding" title="Permanent link">&para;</a></h3>
<p>Depending on the mode-of-operation of your version, you may need to <strong>pad</strong> the plaintext. If so, there will also be a need to <strong>unpad</strong> during the decryption process. The sample reference uses functions named <code>kef.pad()</code> and <code>kef.unpad()</code>, which are called from inside the <code>kef.Cipher</code> object when encrypting and decrypting.</p>
<h3 id="data-compression-deflate-inflate">Data Compression: Deflate &amp; Inflate<a class="headerlink" href="#data-compression-deflate-inflate" title="Permanent link">&para;</a></h3>
<p>Depending on the version, you may also need to <strong>deflate</strong> plaintext so that it is compressed before encryption. Likewise, you'll need to <strong>reinflate</strong> it after decryption to decompress the plaintext. The sample reference uses functions named <code>kef.deflate()</code> and <code>kef.reinflate()</code>, which are also called from inside the <code>kef.Cipher</code> object when encrypting and decrypting.</p>
<h3 id="metadata-wrapping-and-unwrapping">Metadata Wrapping and Unwrapping<a class="headerlink" href="#metadata-wrapping-and-unwrapping" title="Permanent link">&para;</a></h3>
<p>After encryption, you'll need to <strong>wrap</strong> the <code>id</code>, <code>version</code>, <code>iterations</code> and <code>cpl</code> into a valid KEF envelope. Likewise, in order to reveal something hidden within a KEF envelope, you'll first need to <strong>unwrap</strong>, or parse it into its constituent parts (<code>id</code>, <code>version</code>, <code>iterations</code>, <code>cpl</code>) so that it may be decrypted as described above. The sample reference uses functions <code>kef.wrap()</code> and <code>kef.unwrap()</code> for these procedures.</p>
<h3 id="on-further-encoding-kef-envelopes">On Further Encoding KEF Envelopes<a class="headerlink" href="#on-further-encoding-kef-envelopes" title="Permanent link">&para;</a></h3>
<p>Outside the scope of this specification on KEF envelopes, which are strings of bytes, implementations will surely need to make choices about encoding/decoding schemes. Whether for QR transport, copy-pasting into messages, embedding into json documents, in-plain-sight within other document formats, or persisted in binary files, these choices are left to implementors.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../encryption/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Encryption Introduction">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Encryption Introduction
              </div>
            </div>
          </a>
        
        
          
          <a href="../../printing/printing/" class="md-footer__link md-footer__link--next" aria-label="Next: Printing">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Printing
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Powered by <a href="https://embit.rocks/">embit</a>, the Bitcoin library for Python 3 and Micropython
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://bitcointalk.org/index.php?topic=5489022.0" target="_blank" rel="noopener" title="Send a message to the Bitcoin Forum" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M461.2 18.9C472.7 24 480 35.4 480 48v416c0 12.6-7.3 24-18.8 29.1s-24.8 3.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0 17.7-14.3 32-32 32h-32c-17.7 0-32-14.3-32-32v-96C57.3 384 0 326.7 0 256s57.3-128 128-128h84.5c61.8-.2 121.4-22.7 167.9-63.3L427 24c9.4-8.3 22.9-10.2 34.3-5.1zM224 320v.2c70.3 2.7 137.8 28.5 192 73.4V118.3c-54.2 44.9-121.7 70.7-192 73.4z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://t.me/SC_Krux" target="_blank" rel="noopener" title="Join our community-led Telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496m115 168.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7.2-.7.3-3.1-1.2-4.4s-3.6-.8-5.1-.5c-2.2.5-37.1 23.5-104.6 69.1-9.9 6.8-18.9 10.1-26.9 9.9-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3.6-4.5 6.7-9 18.4-13.7 72.3-31.5 120.5-52.3 144.6-62.3 68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6.5 9.6 2.9 2 1.7 3.2 4.1 3.5 6.7.5 3.2.6 6.5.4 9.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://x.com/selfcustodykrux" target="_blank" rel="noopener" title="Follow us on X (Twitter)" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/selfcustody/krux" target="_blank" rel="noopener" title="Our code on Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.indexes", "navigation.expand", "navigation.footer", "toc.integrate"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>